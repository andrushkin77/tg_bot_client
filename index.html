<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <title>–û—Ñ–æ—Ä–º–ª–µ–Ω–∏–µ –∑–∞–∫–∞–∑–∞</title>
  <script src="https://telegram.org/js/telegram-web-app.js"></script>
  <style>/* ‚Ä¶—Å—Ç–∏–ª–∏ –∏–∑ –∏—Å—Ö–æ–¥–Ω–∏–∫–∞‚Ä¶ */</style>
</head>
<body>
<div class="container">
  <h2>–í–∞—à –∑–∞–∫–∞–∑</h2>
  <img id="orderImage" alt="–§–æ—Ç–æ" style="width:100%;border-radius:10px;">
  <div class="link" onclick="openDelivery()">üì¶ –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –¥–æ—Å—Ç–∞–≤–∫–µ</div>
  <label>–ü–æ–∂–µ–ª–∞–Ω–∏—è:</label>
  <textarea id="wishes" placeholder="‚Ä¶"></textarea>
  <button onclick="submitOrder()">–†–∞–∑–º–µ—Å—Ç–∏—Ç—å –∑–∞–∫–∞–∑</button>
</div>
<script>
  const tg = Telegram.WebApp; tg.expand();
  let img = new URLSearchParams(location.search).get('image_url');
  if (img) localStorage.setItem('image_url', img);
  document.getElementById('orderImage').src = localStorage.getItem('image_url');
  function openDelivery(){
    const id = localStorage.getItem('order_id');
    location.href = `delivery.html${id?'?order_id='+id:''}`;
  }
  function submitOrder(){
    const del = JSON.parse(localStorage.getItem('deliveryData')||'{}');
    const payload = {
      action:"submit_order",
      image_url: localStorage.getItem('image_url'),
      wishes: document.getElementById('wishes').value,
      city: del.city, deliveryAddress:del.address,
      recipient_name:del.recipient_name,
      recipient_phone:del.recipient_phone
    };
    tg.sendData(JSON.stringify(payload));
    tg.close();
  }
</script>
</body>
</html>
