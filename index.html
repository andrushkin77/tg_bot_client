<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–û—Ñ–æ—Ä–º–ª–µ–Ω–∏–µ –∑–∞–∫–∞–∑–∞</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Arial', sans-serif; }
        body { background-color: #f8f8f8; color: #333; text-align: center; padding: 20px; }
        .container { max-width: 400px; margin: 0 auto; background: #fff; padding: 20px; border-radius: 15px; box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1); }
        h2 { font-size: 22px; margin-bottom: 15px; color: #d61a1a; }
        .image-container { background: #fff; border-radius: 10px; overflow: hidden; margin-bottom: 15px; }
        img { width: 100%; display: block; border-radius: 10px; }
        .input-group { margin-bottom: 15px; text-align: left; }
        label { font-weight: bold; display: block; margin-bottom: 5px; }
        select, input, textarea { width: 100%; padding: 12px; font-size: 16px; border: 2px solid #ddd; border-radius: 8px; outline: none; transition: border 0.3s ease-in-out; }
        select:focus, input:focus, textarea:focus { border-color: #d61a1a; }
        textarea { resize: none; height: 60px; }
        .button { display: block; width: 100%; padding: 14px; font-size: 18px; font-weight: bold; color: white; background: #d61a1a; border: none; border-radius: 10px; cursor: pointer; transition: background 0.3s ease; }
        .button:hover { background: #b91515; }
        .error-message, .success-message { font-size: 14px; margin-top: 10px; display: none; }
        .error-message { color: red; }
        .success-message { color: green; }
    </style>
</head>
<body>

    <div class="container">
        <h2>–û—Ñ–æ—Ä–º–ª–µ–Ω–∏–µ –∑–∞–∫–∞–∑–∞</h2>

        <div class="image-container">
            <img id="orderImage" src="" alt="–ö–æ–º–ø–æ–∑–∏—Ü–∏—è">
        </div>

        <div class="input-group">
            <label for="deliveryType">–°–ø–æ—Å–æ–± –ø–æ–ª—É—á–µ–Ω–∏—è:</label>
            <select id="deliveryType">
                <option value="–°–∞–º–æ–≤—ã–≤–æ–∑">–°–∞–º–æ–≤—ã–≤–æ–∑</option>
                <option value="–î–æ—Å—Ç–∞–≤–∫–∞">–î–æ—Å—Ç–∞–≤–∫–∞</option>
            </select>
        </div>

        <div class="input-group">
            <label for="deliveryTime">–í—Ä–µ–º—è –ø–æ–ª—É—á–µ–Ω–∏—è:</label>
            <input type="time" id="deliveryTime">
        </div>

        <div class="input-group">
            <label for="comment">–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π:</label>
            <textarea id="comment" placeholder="–í–∞—à–∏ –ø–æ–∂–µ–ª–∞–Ω–∏—è..."></textarea>
        </div>

        <button class="button" id="submitButton" onclick="submitOrder()">–†–∞–∑–º–µ—Å—Ç–∏—Ç—å –∑–∞–∫–∞–∑</button>

        <div id="error" class="error-message">‚ùå –û—à–∏–±–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏ –¥–∞–Ω–Ω—ã—Ö. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ —Å–Ω–æ–≤–∞.</div>
        <div id="success" class="success-message">‚úÖ –ó–∞–∫–∞–∑ —É—Å–ø–µ—à–Ω–æ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω!</div>
    </div>

    <script>
        let tg = window.Telegram.WebApp;
        tg.expand();

        let orderImage = document.getElementById("orderImage");
        let params = new URLSearchParams(window.location.search);
        let imageUrl = params.get("image_url");

        if (imageUrl) {
            orderImage.src = imageUrl;
        } else {
            orderImage.style.display = "none";
        }

        async function submitOrder() {
            let orderData = {
                deliveryType: document.getElementById("deliveryType").value,
                deliveryTime: document.getElementById("deliveryTime").value,
                comment: document.getElementById("comment").value,
            };

            console.log("üì§ –û—Ç–ø—Ä–∞–≤–∫–∞ –¥–∞–Ω–Ω—ã—Ö –≤ –±–æ—Ç–∞:", orderData);

            let submitButton = document.getElementById("submitButton");
            let successMessage = document.getElementById("success");
            let errorMessage = document.getElementById("error");

            submitButton.disabled = true;

            try {
                // üî• 1. –ü—Ä—è–º–æ–π API-–∑–∞–ø—Ä–æ—Å –≤ –±–æ—Ç–∞
                let botToken = "7947042875:AAH74wWcNGDD0hXaPqqo9RYZlmI9AZp3BJI";  // ‚úÖ –í—Å—Ç–∞–≤—å API-—Ç–æ–∫–µ–Ω –±–æ—Ç–∞
                let chatId = tg.initDataUnsafe.user.id;  // ‚úÖ ID –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è Telegram

                let response = await fetch(`https://api.telegram.org/bot${botToken}/sendMessage`, {
                    method: "POST",
                    headers: { "Content-Type": "application/json" },
                    body: JSON.stringify({
                        chat_id: chatId,
                        text: `üì¶ –ù–æ–≤—ã–π –∑–∞–∫–∞–∑:\n–°–ø–æ—Å–æ–± –ø–æ–ª—É—á–µ–Ω–∏—è: ${orderData.deliveryType}\n–í—Ä–µ–º—è: ${orderData.deliveryTime}\n–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π: ${orderData.comment}`
                    })
                });

                let data = await response.json();

                if (data.ok) {
                    console.log("‚úÖ –î–∞–Ω–Ω—ã–µ —É—Å–ø–µ—à–Ω–æ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω—ã —á–µ—Ä–µ–∑ API");
                    successMessage.style.display = "block";
                    errorMessage.style.display = "none";

                    setTimeout(() => {
                        Telegram.WebApp.close();
                    }, 700);
                } else {
                    throw new Error(`–û—à–∏–±–∫–∞ Telegram API: ${JSON.stringify(data)}`);
                }
            } catch (error) {
                console.error("‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ –æ—Ç–ø—Ä–∞–≤–∫–µ –¥–∞–Ω–Ω—ã—Ö —á–µ—Ä–µ–∑ API:", error);
                errorMessage.style.display = "block";
                successMessage.style.display = "none";
                submitButton.disabled = false;
            }
        }
    </script>

</body>
</html>
