<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <title>–û—Ñ–æ—Ä–º–ª–µ–Ω–∏–µ –∑–∞–∫–∞–∑–∞</title>
  <script src="https://telegram.org/js/telegram-web-app.js"></script>
  <style>
    body  { background:#161616; color:#fff; font-family:Arial,sans-serif; padding:20px }
    .container { background:#1e1e1e; padding:20px; border-radius:10px }
    textarea, button { width:100%; padding:10px; margin-top:10px; border:none; border-radius:5px }
    textarea { background:#292929; color:#fff }
    /* –æ—Å–Ω–æ–≤–Ω–∞—è –∑–µ–ª—ë–Ω–∞—è –∫–Ω–æ–ø–∫–∞ */
    .primary-btn { background:#32CD32; color:#fff; font-weight:bold }
    /* –ø–æ–ª—É–ø—Ä–æ–∑—Ä–∞—á–Ω–∞—è ¬´–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –¥–æ—Å—Ç–∞–≤–∫–µ¬ª  */
    .ghost-btn   {
      background:rgba(255,255,255,0.08);        /* –ª—ë–≥–∫–∞—è –ø—Ä–æ–∑—Ä–∞—á–Ω–æ—Å—Ç—å */
      color:#fff;
      backdrop-filter:blur(4px);
      border:1px solid rgba(255,255,255,0.15);  /* —Ç–æ–Ω–∫–∞—è —Ä–∞–º–∫–∞ –∫–∞–∫ –≤ –∫–æ—Ä–∑–∏–Ω–µ */
      display:flex; align-items:center; gap:8px; justify-content:center;
    }
    .ghost-btn:hover { background:rgba(255,255,255,0.15) }
  </style>
</head>
<body>
<div class="container">
  <h2>–í–∞—à –∑–∞–∫–∞–∑</h2>

  <img id="orderImage" style="width:100%;border-radius:10px" alt="–§–æ—Ç–æ –∑–∞–∫–∞–∑–∞">

  <!-- 1. –≤–∞—à–∏ –ø–æ–∂–µ–ª–∞–Ω–∏—è -->
  <label style="margin-top:15px">–í–∞—à–∏¬†–ø–æ–∂–µ–ª–∞–Ω–∏—è:</label>
  <textarea id="wishes" placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä, –¥–æ–±–∞–≤–∏—Ç—å –∫—Ä–∞—Å–Ω—ã–µ —à–∞—Ä—ã..."></textarea>

  <!-- 2. –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –¥–æ—Å—Ç–∞–≤–∫–µ  -->
  <button class="ghost-btn" style="margin-top:10px" onclick="openDeliveryPage()">
    üì¶¬†–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è¬†–æ¬†–¥–æ—Å—Ç–∞–≤–∫–µ
  </button>

  <!-- 3. —Ä–∞–∑–º–µ—Å—Ç–∏—Ç—å –∑–∞–∫–∞–∑ -->
  <button class="primary-btn" style="margin-top:15px" onclick="submitOrder()">
    –†–∞–∑–º–µ—Å—Ç–∏—Ç—å¬†–∑–∞–∫–∞–∑
  </button>
</div>

<script>
  const tg = Telegram.WebApp; tg.expand();

  /* –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è */
  let imageUrl = new URLSearchParams(location.search).get('image_url');
  if (imageUrl) localStorage.setItem('image_url', imageUrl);
  else          imageUrl = localStorage.getItem('image_url');
  orderImage.src = imageUrl;

  function openDeliveryPage(){
    const id = localStorage.getItem('order_id');
    location.href = id ? `delivery.html?order_id=${id}` : 'delivery.html';
  }

  function submitOrder(){
    const d = JSON.parse(localStorage.getItem('deliveryData')||'{}');
    const payload = {
      action:'submit_order', image_url:imageUrl,
      wishes:wishes.value,
      city:d.city, deliveryAddress:d.address,
      recipient_name:d.recipient_name, recipient_phone:d.recipient_phone
    };
    tg.sendData(JSON.stringify(payload)); tg.close();
  }
</script>
</body>
</html>
